# Pattern Learner Database
# Captures lessons learned, anti-patterns, and reusable solutions

patterns:

    - id: "pat-219191-7ff433b2"
      name: "Hybrid search with Reciprocal Rank Fusion"
      context: "Implementing semantic search with limited dependencies"
      problem: "Combining results from multiple ranking signals (FTS5 BM25 and vector cosine similarity) that use incompatible score scales"
      solution: "Use Reciprocal Rank Fusion (RRF): score = sum(1/(k+rank)) where k=60. RRF is rank-based, not score-based, so it handles different scales naturally. Records appearing in both result sets get boosted."
      category: "general"
      origin: "session-2026-02-15"
      confidence: 0.5
      validations: 0
      created_at: "2026-02-16T05:19:51Z"
    - id: "pat-092136-e3216f19"
      name: "Prototype Decomposition"
      context: "Praxis prototype proved Sync-Promote-Execute lifecycle in Python. Needed to distribute implementation across existing shell-based repos (Lineage, Neo) without introducing Python or new projects."
      problem: ""
      solution: "Build prototype to validate design intent. Decompose into plan files targeting existing repos â€” each plan references prototype code by file and line for design intent, implements in target repo's conventions. Prototype dissolves after plans execute. Key: plan files gate dependencies (Lineage inbox before Neo sync), include What NOT to Do sections to prevent scope creep, and explicitly forbid copying the prototype's technology choices."
      category: "general"
      origin: "session-2026-02-14"
      confidence: 0.5
      validations: 0
      created_at: "2026-02-14T18:02:16Z"
    - id: "pat-001891-ec497317"
      name: "Architecture decisions"
      context: "Promoted from Mirror judgment analysis"
      problem: ""
      solution: ""
      category: "general"
      origin: "session-2026-02-13"
      confidence: 0.5
      validations: 0
      created_at: "2026-02-13T16:58:11Z"
    - id: "pat-001505-ede78294"
      name: "Architecture decisions"
      context: "Promoted from Mirror judgment analysis"
      problem: ""
      solution: ""
      category: "general"
      origin: "session-2026-02-13"
      confidence: 0.5
      validations: 0
      created_at: "2026-02-13T16:51:45Z"
    - id: "pat-001502-a61ddbd4"
      name: "Architecture decisions"
      context: "Promoted from Mirror judgment analysis"
      problem: ""
      solution: ""
      category: "general"
      origin: "session-2026-02-13"
      confidence: 0.5
      validations: 0
      created_at: "2026-02-13T16:51:42Z"
    - id: "pat-000001-seed"
      name: "Safe bash arithmetic"
      context: "Incrementing variables in bash with set -e"
      problem: "((x++)) returns exit code 1 when x is 0, causing script to exit"
      solution: "Use x=$((x + 1)) instead of ((x++))"
      category: "bash"
      origin: "session-2026-02-09"
      confidence: 0.9
      validations: 5
      created_at: "2026-02-09T12:00:00Z"
      examples:
        - bad: "((count++))"
        - good: "count=$((count + 1))"

    - id: "pat-000002-seed"
      name: "Quote variables in bash"
      context: "Using variables in bash commands, especially with paths"
      problem: "Unquoted variables with spaces or special characters cause word splitting"
      solution: "Always quote variables: \"$var\" instead of $var"
      category: "bash"
      origin: "session-2026-02-09"
      confidence: 0.85
      validations: 3
      created_at: "2026-02-09T12:00:00Z"
      examples:
        - bad: "rm -rf $path"
        - good: "rm -rf \"$path\""

    - id: "pat-000003-seed"
      name: "Use set -euo pipefail"
      context: "Writing robust bash scripts"
      problem: "Scripts continue after errors, leading to cascading failures"
      solution: "Start scripts with set -euo pipefail for strict error handling"
      category: "bash"
      origin: "session-2026-02-09"
      confidence: 0.95
      validations: 10
      created_at: "2026-02-09T12:00:00Z"
      examples:
        - bad: "#!/bin/bash"
        - good: "#!/usr/bin/env bash\nset -euo pipefail"

    - id: "pat-000004-seed"
      name: "YAML templates as contracts"
      context: "Defining interfaces between components in multi-agent systems"
      problem: "Unclear interfaces lead to integration failures"
      solution: "Use YAML templates as de facto API contracts between components"
      category: "architecture"
      origin: "session-2026-02-09"
      confidence: 0.8
      validations: 2
      created_at: "2026-02-09T12:00:00Z"

    - id: "pat-000005-seed"
      name: "Hierarchical agent orchestration"
      context: "Designing multi-agent systems with clear responsibilities"
      problem: "Overlapping responsibilities cause conflicts and confusion"
      solution: "Separate static registry (lore) vs dynamic execution (neo) vs intent/goals (oracle)"
      category: "architecture"
      origin: "session-2026-02-09"
      confidence: 0.75
      validations: 1
      created_at: "2026-02-09T12:00:00Z"

    - id: "pat-000006-seed"
      name: "Optimal agent batch size"
      context: "Parallelizing work across multiple agents"
      problem: "Too many agents cause fragmentation, too few underutilize resources"
      solution: "Optimal batch is approximately 3 agents per cycle for parallelism without fragmentation"
      category: "architecture"
      origin: "session-2026-02-09"
      confidence: 0.7
      validations: 1
      created_at: "2026-02-09T12:00:00Z"

    - id: "pat-000007-seed"
      name: "Establish file format conventions early"
      context: "Starting a new project with multiple components"
      problem: "Small structural decisions propagate and become hard to change later"
      solution: "Establish file format and naming conventions in Cycle 1 of the project"
      category: "architecture"
      origin: "session-2026-02-09"
      confidence: 0.8
      validations: 2
      created_at: "2026-02-09T12:00:00Z"

    - id: "pat-000008-seed"
      name: "Trap for cleanup"
      context: "Bash scripts that create temporary files or acquire resources"
      problem: "Resources are not cleaned up when script exits unexpectedly"
      solution: "Use trap 'cleanup_function' EXIT to ensure cleanup runs on exit"
      category: "bash"
      origin: "session-2026-02-09"
      confidence: 0.9
      validations: 4
      created_at: "2026-02-09T12:00:00Z"
      examples:
        - good: "trap 'rm -f \"$temp_file\"' EXIT"

    - id: "pat-000009-monarch"
      name: "Contract interfaces"
      context: "Markdown-based interface contracts between components (flow, bach, ralph)"
      problem: "Unclear interfaces lead to integration failures and tight coupling"
      solution: "Use dedicated CONTRACT.md files at project boundaries defining input/output formats"
      category: "architecture"
      origin: "lore-pattern-sharing"
      confidence: 0.8
      validations: 3
      created_at: "2026-02-10T06:00:00Z"

    - id: "pat-000010-monarch"
      name: "Narrow interfaces"
      context: "Multi-component systems where components should only know adjacent neighbors"
      problem: "Components reaching past their neighbors creates hidden coupling"
      solution: "Components communicate only through adjacent interfaces, never bypassing the pipeline"
      category: "architecture"
      origin: "lore-pattern-sharing"
      confidence: 0.8
      validations: 1
      created_at: "2026-02-10T06:00:00Z"

    - id: "pat-000011-monarch"
      name: "CLAUDE.md as agent entry point"
      context: "Projects that need to be navigable by AI agents"
      problem: "Agents waste time orienting without a standard entry point"
      solution: "Every project gets a CLAUDE.md with quick reference, structure, conventions, and integration notes"
      category: "architecture"
      origin: "lore-pattern-sharing"
      confidence: 0.95
      validations: 7
      created_at: "2026-02-10T06:00:00Z"

    - id: "pat-000012-monarch"
      name: "Unified memory via Lineage"
      context: "Multiple projects generating decisions, patterns, and handoffs"
      problem: "Decisions scatter across ad-hoc markdown files in each project"
      solution: "Projects write memory to Lineage using fail-silent client libraries; operational state stays local"
      category: "architecture"
      origin: "lore-pattern-sharing"
      confidence: 0.7
      validations: 1
      created_at: "2026-02-10T06:00:00Z"

anti_patterns:
    - id: "anti-000001-seed"
      name: "Baked-in credentials"
      symptom: "Credentials stored in container image or code"
      risk: "Credential exfiltration by compromised agent or leaked repository"
      fix: "Use credential broker with scoped tokens, or environment variables from secure vault"
      category: "security"
      severity: "critical"
      created_at: "2026-02-09T12:00:00Z"

    - id: "anti-000002-seed"
      name: "Unquoted variable expansion"
      symptom: "Using $var instead of \"$var\" in bash"
      risk: "Word splitting, glob expansion, command injection vulnerabilities"
      fix: "Always quote variable expansions: \"$var\""
      category: "bash"
      severity: "high"
      created_at: "2026-02-09T12:00:00Z"

    - id: "anti-000003-seed"
      name: "rm -rf with unvalidated path"
      symptom: "Using rm -rf on a path from variable without validation"
      risk: "Accidental deletion of critical system files or entire directories"
      fix: "Validate path exists and is expected before deletion; use safeguards like checking path length"
      category: "bash"
      severity: "critical"
      created_at: "2026-02-09T12:00:00Z"

    - id: "anti-000004-seed"
      name: "Silent failure mode"
      symptom: "Scripts that continue executing after errors without logging"
      risk: "Cascading failures, difficult debugging, inconsistent state"
      fix: "Use set -e, proper error handling, and comprehensive logging"
      category: "bash"
      severity: "high"
      created_at: "2026-02-09T12:00:00Z"

    - id: "anti-000005-seed"
      name: "Monolithic agent design"
      symptom: "Single agent responsible for too many concerns"
      risk: "Difficult to scale, test, or modify; single point of failure"
      fix: "Decompose into specialized agents with clear responsibilities"
      category: "architecture"
      severity: "medium"
      created_at: "2026-02-09T12:00:00Z"

    - id: "anti-000006-seed"
      name: "Missing idempotency"
      symptom: "Operations that produce different results when run multiple times"
      risk: "Inconsistent state, failed retries, difficult recovery"
      fix: "Design operations to be idempotent; check state before modifying"
      category: "architecture"
      severity: "high"
      created_at: "2026-02-09T12:00:00Z"
